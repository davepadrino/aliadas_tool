<!DOCTYPE html>
<html>
<head>
	<title>Agregar Alumnos - Aliadas en Cadena</title>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
 	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
 	<link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="../app/css/aliadas.css">
	<link rel="stylesheet" type="text/css" href="../app/css/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" media="screen" href="../app/css/responsive.css"/> 
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.js"></script>
	<script src="https://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.0.0.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="../example.js"></script>

	<!-- #######################################################################-->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/fontawesome/4.5.0/css/font-awesome.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="//mgcrea.github.io/angular-strap/styles/libs.min.css">
    <link rel="stylesheet" href="//mgcrea.github.io/angular-strap/styles/docs.min.css">
    <link rel="stylesheet" href="style.css" />
    <script src="//cdn.jsdelivr.net/angularjs/1.5.5/angular-sanitize.min.js" data-semver="1.5.5"></script>
    <script src="//mgcrea.github.io/angular-strap/dist/angular-strap.js" data-semver="v2.3.8"></script>
    <script src="//mgcrea.github.io/angular-strap/dist/angular-strap.tpl.js" data-semver="v2.3.8"></script>
    <script src="//mgcrea.github.io/angular-strap/docs/angular-strap.docs.tpl.js" data-semver="v2.3.8"></script>


</head>
<body ng-app="myApp">
	<header>
		<div id="menu-fijo" class="row">
			<div class="logo col-md-3 col-md-3">
				<div>
					<a href="principal.html">
						<img src="../app/img/logo.jpg" alt="Logo" /> 
					</a>
				</div>
			</div>
			<div class="col-md-5 col-md-5">	
			    <div class="input-group">
			      <span class="input-group-btn">
			        <button class="btn btn-default" type="button">Buscar</button>
			      </span>
			      <input type="text" class="form-control" placeholder="Buscar alumno...">
			    </div>
			</div>
			<div class="col-md-4 col-md-4">
				<div class="control-top">Hola, Usuario</div>
			</div>	
		</div>	
		<div class="menu-bar">
			<a href="#" class="bt-menu">
				<span class="glyphicon glyphicon-menu-hamburger"></span>Menu
			</a>
		</div>
		<nav>
			<ul>
				<li><a href="principal.html"><span class="glyphicon glyphicon-glyphicon glyphicon-home"></span> Inicio </a></li>
				<li><a href="add_course.html"><span class="glyphicon  glyphicon-new-window"></span>
				Agregar Curso </a></li>		
				<li id ="sm1" class="submenu">
					<a href="#">
						<span class="glyphicon glyphicon-grain"> Asistencia / Notas
						<span class="caret"></span>
					</a>
					<ul id="childrenSM1" class="children">
						<li><a href="#">Mujeres Emprendedoras</a></li>
						<li><a href="#">Escuela - Taller</a></li>
						<li><a href="#">Mujeres Hacedoras</a></li>
					</ul>
					</span>
				</li>
				<div class="control-top">
					<ul>
						<li><a href="manage_users.html"><span class="glyphicon glyphicon-user"></span> Editar Usuarios</a></li>
						<li id ="sm2" class="submenu">
							<a href="#">
								<span class="glyphicon glyphicon-cog"> Configuración
								<span class="caret"></span></span>	
							</a>
							<ul id="childrenSM2" class="children">	
								<li><a href="edit_user.html"><span class="glyphicon glyphicon-pencil"></span> Editar Usuario</a></li>			
								<li><a href="../index.html"><span class="glyphicon glyphicon-off"></span> Cerrar Sesión</a></li>	
							</ul>	
						</li>
					</ul>
				</div>
			</ul>
		</nav>
	</header>
	<div id="agregar_alumno">	
		<div class="row">
			<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
			</div>

			<div class="col-xs-10 col-sm-10 col-md-10 col-lg-10">
				<div>
					<h2> Agregar Alumnos </h2>
				</div>
				<div class="row">
					<div id="alumnSearch" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
						<div>
							<form ng-controller="TypeaheadDemoCtrl">
								<table id="form">
									<tr>
										<td>
											<div class="input-group">
											<label for="search">Buscar Alumno</label>
												<input type="text" class="form-control" name="search" ng-model="selected" bs-options="state.ci for state in brandList" bs-typeahead>
												<span class="input-group-btn">
						                        <button class="btn btn-default" ng-click="addToList(selected)" type="button">Agregar</button>
						                    </span>				
											</div>
										</td>
									</tr>								
								</table>
							</form>
						</div>
						<div id ="addAlumnForm" ng-controller="FormController as formCtrl">
							<div ng-show="formCtrl.myVar">
				           	<form ng-submit="formCtrl.submitForm()">
				                <table id="form">
				                	<tr>
				                        <td>
				                        	<label for="id">CI</label>
				                            <input type="text" class="form-control" name="id" placeholder="Cédula de Identidad" ng-model="formCtrl.form.ci" required>
				                        </td>
				                    </tr>
				                    <tr>
				                        <td>
				                        	<label for="name">Nombre</label>
				                            <input type="text" class="form-control" name="name" placeholder="Nombre" ng-model="formCtrl.form.name" required>
				                        </td>
				                    </tr>
				                    <tr>
				                        <td>
				                            <label for="apellido">Apellido</label>
				                            <input type="text" class="form-control" name="apellido" placeholder="Apellido" ng-model="formCtrl.form.lastName" required>
				                        </td>
				                    </tr>
				                    <tr>
				                        <td>
				                            <label for="address">Dirección</label>
				                            <input type="text" class="form-control" name="address" ng-model="formCtrl.form.address" placeholder="Dirección">
				                        </td>
				                    </tr>
				                    <tr>
				                        <td>
				                            <label for="numTel">Número Telefónico</label>
				                            <input type="text" class="form-control" name="numTel" ng-model="formCtrl.form.phone" placeholder="04XXYYYYYYY">
				                        </td>
				                    </tr>
				                    <tr>
				                        <td>
				                            <label for="Email">Correo</label>
				                            <input type="email" class="form-control" name="email" ng-model="formCtrl.form.email" placeholder="correo@dominio.com">
				                        </td>
				                    </tr>
				                </table>
				             	<div class="addField">
				             		<input class="btn btn-success" type="Submit" value="Agregar Alumno" />
				             	</div>	
				             	
				            </form>
				            </div>
				            <div class="addField">
					            <!--
					            <button type="button" class="btn btn-primary" ng-click="formCtrl.toggle()"> 
									Crear Nuevo <span class="glyphicon glyphicon-plus"></span>
								</button>
								-->
								<button type="button" class="btn btn-primary" ng-click="formCtrl.toggle()"> 
									{{formCtrl.toggleText}} <span class="glyphicon glyphicon-plus"></span>
								</button>

							</div>
				        </div>
					</div>
					<div id ="alumnList" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
						<h1 class="text-center">Lista de alumnos inscritos</h1>
					    <div ng-controller="ListController as listCtrl">
					        <table  class="table table-striped table-hover" >
					            <thead>
					            	<th> CI </th>
					                <th> Nombre</th>
					                <th colspan="2"> Apellido</th>
					            </thead>
					            <tbody>
					                <tr ng-repeat="brand in listCtrl.brands">
					                	<td ng-bind="brand.id"></td>
					                    <td ng-bind="brand.name"></td>
					                    <td ng-bind="brand.lastName"></td>
					                    <td class="text-right"><button class="btn glyphicon glyphicon-remove btn-danger btn-sm" ng-click="listCtrl.removeBrand($index)"></button></td>
					                </tr>
					            </tbody>
					        </table>
					    </div>
					</div>
				</div>
			</div>
        	<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../app/js/aliadas.js"></script>

<script>
//var app = angular.module("myApp", [])
 var app = angular.module('myApp', ['ngAnimate', 'ngSanitize', 'mgcrea.ngStrap'])


    .controller('TypeaheadDemoCtrl', function($scope, $templateCache, $http, BrandService) {

    $scope.selected = '';
    $scope.brandList = BrandService.get();

    /*
    $scope.form = {
        ci: "",
        name: "",
        lastName: "",
        address: "",
        phone: "",
        email: ""
    };
    */
    $scope.addToList = function() {
        //BrandService.add($scope.selected);
        //alert($scope.selected.name);
        list = BrandService.get();
        console.log($scope.selected);
        console.log($scope.selected in list);
        var flag = 0;
        for (var i = 0; i < list.length; i++) {
            if($scope.selected.ci === list[i]["ci"]){
                alert("El alumno ya esta inscrito");
                flag = 1; // 1 para inscrito
                break;
            }
        }
             $http
                    .post("", $scope.selected)
                    .then(function(resp){
                        console.log(resp);
                        
                        // Example to update the brand service
                        $scope.form = {
                            ci: $scope.selected.ci,
                            name: $scope.selected.name,
                            lastName: $scope.selected.lastName,
                            address: $scope.selected.address,
                            phone: $scope.selected.phone,
                            email: $scope.selected.email
                        };
                        if ($scope.selected != '' && flag != 1 && $scope.selected.name != undefined){
                            BrandService.add($scope.form);
                        }
                        // when successfully submitted
                                                
                    });
    };
})



.controller("FormController", ["$http", "BrandService", function($http, BrandService){
    var ctrl = this;
    ctrl.form = {
        ci: "",
        name: "",
        lastName: "",
        address: "",
        phone: "",
        email: ""
    };
   
    ctrl.myVar = false;
    ctrl.toggleText = "Abrir Formulario";

    ctrl.toggle = function() {
        ctrl.myVar = !ctrl.myVar;
        ctrl.toggleText = "Cerrar Formulario";

    };

    ctrl.submitForm = function(){
        $http
            //.post("/admin.brands/update", ctrl.form)
            .post("", ctrl.form)
            .then(function(resp){
                console.log(resp);
                
                // Example to update the brand service
                BrandService.add(ctrl.form);
                ctrl.form = {
        			ci: "",
                    name: "",
                    lastName: "",
                    address: "",
			        phone: "",
        			email: ""
                };
                // when successfully submitted
                
            }, function(err){
                console.log(err);
                
                // Not supposed to do this here, but just to Example updating the brand service
                BrandService.add(ctrl.form);
                ctrl.form = {
        			ci: "",
                    name: "",
                    lastName: "",
                    address: "",
			        phone: "",
        			email: ""
                };
                // When got some error
            });
    };
}])
.controller("ListController", ["$http", "BrandService", function($http, BrandService){
    var ctrl = this;
    
    ctrl.brands = BrandService.get();
    ctrl.removeBrand = BrandService.remove;
}])

.factory("BrandService", function(){
    var brandList = [{
        name: "Name1",
        lastName: "LastName1",
        ci: "20328774"
    }, {
        name: "Name2",
        lastName: "LastName2",
        ci: "213234234"
    }];
    
    return {
        get: function(){
            return brandList;
        },
        add: function(newBrand){
            brandList.push(newBrand);
        },
        remove: function(index){
            brandList.splice(index, 1);
        }
    };
});

angular.bootstrap(document, ['myApp']);

</script>
</body>
</html>

